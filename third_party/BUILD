package(default_visibility = ["//visibility:public"])

load("//lib/bazel:c_rules.bzl", "makani_c_library")

# This compiles the subset of GSL needed for the c_math library.
makani_c_library(
    name = "c_math_gsl",
    srcs = [
        "gsl/blas/blas.c",
        "gsl/cblas/daxpy.c",
        "gsl/cblas/ddot.c",
        "gsl/cblas/dgemv.c",
        "gsl/cblas/dnrm2.c",
        "gsl/cblas/drot.c",
        "gsl/cblas/dscal.c",
        "gsl/cblas/dtrsm.c",
        "gsl/cblas/dtrsv.c",
        "gsl/cblas/xerbla.c",
        "gsl/linalg/bidiag.c",
        "gsl/linalg/householder.c",
        "gsl/linalg/qr.c",
        "gsl/linalg/qrpt.c",
        "gsl/matrix/copy.c",
        "gsl/matrix/getset.c",
        "gsl/matrix/init.c",
        "gsl/matrix/matrix.c",
        "gsl/matrix/rowcol.c",
        "gsl/matrix/submatrix.c",
        "gsl/matrix/swap.c",
        "gsl/matrix/view.c",
        "gsl/permutation/init.c",
        "gsl/permutation/permutation.c",
        "gsl/permutation/permute.c",
        "gsl/sys/fdiv.c",
        "gsl/sys/hypot.c",
        "gsl/sys/infnan.c",
        "gsl/vector/copy.c",
        "gsl/vector/subvector.c",
        "gsl/vector/swap.c",
        "gsl/vector/vector.c",
        "gsl/vector/view.c",
    ] + glob(["**/*.h"]),
    # GSL's source needs to #include these files. Placing them in srcs would
    # cause Bazel to try to compile them independently.
    hdrs = [
        "gsl/linalg/apply_givens.c",
        "gsl/linalg/givens.c",
        "gsl/matrix/copy_source.c",
        "gsl/matrix/getset_source.c",
        "gsl/matrix/init_source.c",
        "gsl/matrix/rowcol_source.c",
        "gsl/matrix/submatrix_source.c",
        "gsl/matrix/swap_source.c",
        "gsl/matrix/view_source.c",
        "gsl/permutation/permute_source.c",
        "gsl/vector/copy_source.c",
        "gsl/vector/subvector_source.c",
        "gsl/vector/swap_source.c",
        "gsl/vector/view_source.c",
    ],
    copts = [
        "-Ithird_party/gsl",
        "-Ithird_party/gsl/makani_config/arm",
        "-w",  # Disable warnings generated by this library.
    ],
    defines = ["USE_BLAS=1"],
)
